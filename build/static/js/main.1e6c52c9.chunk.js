(this["webpackJsonppop-health-app"]=this["webpackJsonppop-health-app"]||[]).push([[0],{25:function(e,t,a){},29:function(e,t,a){e.exports=a.p+"static/media/logo.21f34708.png"},30:function(e,t,a){e.exports=a.p+"static/media/logo.bb973869.svg"},33:function(e,t,a){e.exports=a(55)},43:function(e,t,a){},45:function(e,t,a){},46:function(e,t,a){},47:function(e,t,a){},48:function(e,t,a){},49:function(e,t,a){},51:function(e,t,a){},52:function(e,t,a){},53:function(e,t,a){},54:function(e,t,a){},55:function(e,t,a){"use strict";a.r(t);var r=a(0),n=a.n(r),o=a(26),i=a.n(o),s=a(2),c=a(3),l=a(5),u=a(4),d=a(6),m=a(8),p=a(59),h=a(18),f=a(28),y=a(9),g=a(7),v="actions:dataSources:toggle",b="actions:dataSources:loadData",E="actions:dataSources:merge";function O(e){var t=0;for(var a in e)e[a].enabled&&(t+=1);return t}var j={sqlEditor:{height:200,options:{value:"",language:"sql",lineNumbers:"on",scrollBeyondLastLine:!1,automaticLayout:!0,emptySelectionClipboard:!1,folding:!0,fontFamily:"Menlo, monospace",fontSize:13,glyphMargin:!0,lineHeight:16,mouseWheelZoom:!0,renderLineHighlight:"all",minimap:{enabled:!1,renderCharacters:!1}}}};var N=window,k=N.location,x=N.fetch;function S(e,t){var a=new URL(e,k.origin);return x(a.href,Object(g.a)({mode:"cors",credentials:"include"},t)).then((function(e){if(!e.ok){var t=new Error("".concat(e.status," ").concat(e.statusText));throw Object.defineProperty(t,"data",{value:{status:e.status,statusText:e.statusText}}),t}return e})).then((function(e){return e.json()})).then((function(e){if(e.error)throw new Error(e.error);return e}))}var w={login:function(e,t){var a=new URLSearchParams;return a.set("username",e),a.set("password",t),S("auth/login",{method:"POST",body:a})},logout:function(){return S("auth/logout")},query:function(e){var t=new URLSearchParams;return t.append("query",e),S("sql",{method:"POST",body:t})},request:S},M=window.jQuery,D={loading:!1,error:null,currentUser:JSON.parse(sessionStorage.currentUser||"null")},C="actions:auth:setLoading";function A(e){return{type:C,payload:e}}function z(e){return{type:"actions:auth:merge",payload:e}}var I="actions:payers:loadData";var q={startYear:2016},R={loading:!1,error:null,data:null,uri:""},Y="actions:measureResults:setError",T="actions:measureResults:setData";function U(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=t.org,r=t.ds,n=new URLSearchParams;if(n.append("startDate","".concat(q.startYear,"-01-01")),n.append("endDate","".concat(q.startYear+1,"-12-31")),a?n.append("org",a):Object.keys(e.organizations).map((function(t){return e.organizations[t].enabled&&n.append("org",t),!0})),r?n.append("ds",r):Object.keys(e.dataSources).map((function(t){return e.dataSources[t].selected&&n.append("ds",t),!0})),!n.has("ds"))return null;var o=new URL(window.location.href),i=o.searchParams.get("sync");i&&(n.append("sync",i),window.history.replaceState&&(o.searchParams.delete("sync"),window.history.replaceState({},"",o.href)));var s=n.toString();return s?"api/measure/result?"+s:null}function L(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return function(t,a){var r=a(),n=U(r,e);n&&n!==r.uri&&(t(P({uri:n,loading:!0})),w.request(n).then((function(e){return t(P({data:e,loading:!1}))}),(function(e){return t(P({error:e,loading:!1}))})))}}function P(e){return{type:"actions:measureResults:merge",payload:e}}var H=[f.a],F=Object(h.d)(Object(h.c)({auth:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:D,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"actions:auth:merge":return M.extend(!0,{},e,t.payload);case C:return Object(g.a)({},e,{loading:!!t.payload});default:return e}},ui:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:j,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"actions:ui:sql-editor:setHeight":return Object(g.a)({},e,{sqlEditor:Object(g.a)({},e.sqlEditor,{height:t.payload})});default:return e}},organizations:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"actions:organization:toggle":return Object(g.a)({},e,Object(y.a)({},t.payload,Object(g.a)({},e[t.payload],{enabled:!e[t.payload].enabled})));case"actions:organization:loadData":var a={};return t.payload.forEach((function(e){a[e.id]=e})),a;default:return e}},dataSources:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case v:var a=O(e);return a<=1&&e[t.payload].selected?e:Object(g.a)({},e,Object(y.a)({},t.payload,Object(g.a)({},e[t.payload],{selected:!e[t.payload].selected})));case b:return Object(g.a)({},t.payload);case E:return window.jQuery.extend(!0,e,t.payload);default:return e}},measures:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"actions:measures:loadData":var a={};return t.payload.forEach((function(e){a[e.id]=e})),a;default:return e}},payers:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"actions:payers:toggle":var a={};for(var r in e)a[r]=Object(g.a)({},e[r],{selected:r===t.payload&&!e[t.payload].selected});return a;case I:var n={};return t.payload.forEach((function(e){n[e.id]=e})),n;default:return e}},measureResults:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:R,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"actions:measureResults:setLoading":return Object(g.a)({},e,{loading:!!t.payload});case Y:return Object(g.a)({},e,{error:t.payload});case T:return Object(g.a)({},e,{data:t.payload});case"actions:measureResults:merge":return Object(g.a)({},e,{},t.payload);default:return e}}}),h.a.apply(void 0,H)),_=F;w.request("api/ui").then((function(e){F.dispatch(function(e){return{type:"actions:organization:loadData",payload:e}}(e.organizations)),F.dispatch(function(e){return function(t){t({type:I,payload:e})}}(e.payers)),F.dispatch(function(e){return{type:"actions:measures:loadData",payload:e}}(e.measures)),F.dispatch(function(e){return function(t,a){var r=a(),n={};e.forEach((function(e){var t=!!e.enabled,a=!!e.selected;if("claims"===e.type){t=!1;var o=Object.keys(r.payers).find((function(t){return r.payers[t].ds_id===e.id}));o&&!r.payers[o].selected||(a=!0)}n[e.id]=Object(g.a)({},e,{selected:a,enabled:t})})),t({type:b,payload:n})}}(e.dataSources))})).catch(console.error);var W=a(32),Q=a(31),B=a(58),J=a(57),V=a(29),G=a.n(V),Z=(a(43),function(e){function t(){return Object(s.a)(this,t),Object(l.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this;return n.a.createElement("header",{className:"app-header navbar navbar-expand-lg"},n.a.createElement("div",{className:"container collapse navbar-collapse justify-content-between"},n.a.createElement("div",{className:"navbar-brand"},n.a.createElement(J.a,{className:"app-link",to:"/measures"},n.a.createElement("img",{src:G.a,className:"app-logo",alt:"logo"}))),this.props.user&&n.a.createElement(n.a.Fragment,null,n.a.createElement("ul",{className:"navbar-nav justify-content-center"},n.a.createElement(Q.a,{path:"/measures",render:function(){return n.a.createElement("li",{className:"nav-item"},n.a.createElement("b",{className:"nav-link active"},"Measures"))}}),n.a.createElement(Q.a,{path:"/report",render:function(){return n.a.createElement(n.a.Fragment,null,n.a.createElement("li",{className:"nav-item"},n.a.createElement(J.a,{className:"nav-link",to:"/measures"},"Measures")),n.a.createElement("li",{className:"nav-item"},n.a.createElement("b",{className:"nav-link active"},"Report")))}})),n.a.createElement("ul",{className:"navbar-nav"},n.a.createElement("li",{className:"nav-item text-right"},n.a.createElement("a",{className:"nav-link",onClick:function(t){t.preventDefault(),e.props.dispatch((function(e){return e(A(!0)),w.logout().then((function(){sessionStorage.removeItem("currentUser"),e(z({currentUser:null,error:null,loading:!1}))}))}))},href:"/login"},n.a.createElement("i",{className:"fas fa-power-off"+(this.props.loading?" fa-spin":""),style:{color:"#FA0"}})," Logout"))))))}}]),t}(n.a.Component)),K=(a(45),function(e){function t(){return Object(s.a)(this,t),Object(l.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this,t=this.props.radio?this.props.checked?"fa fa-check-circle":"far fa-circle":this.props.checked?"fas fa-check-square":"far fa-square";return n.a.createElement("label",{className:"checkbox-label"+(this.props.checked?" selected":""),onClick:function(){return!e.props.disabled&&e.props.onChange(!e.props.checked)},disabled:!!this.props.disabled},n.a.createElement("i",{className:t})," ",this.props.label)}}]),t}(n.a.Component)),X=(a(46),function(e){function t(){return Object(s.a)(this,t),Object(l.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this.props,t=e.dataSources,a=e.organizations,r=e.toggleDataSource,o=e.toggleOrg,i=Object.keys(t).filter((function(e){return"ehr"===t[e].type})).map((function(e){return t[e]}));return n.a.createElement("div",null,n.a.createElement("h6",{className:"data-sources-title"},"ORGANIZATIONS"),a.map((function(e){return n.a.createElement(K,{key:e.value,label:e.label,title:e.description,checked:!!e.selected,onChange:function(){return o(e.value)},disabled:e.selected&&a.filter((function(e){return e.selected})).length<2})})),n.a.createElement("br",null),n.a.createElement("br",null),n.a.createElement("h6",{className:"data-sources-title"},"EHR DATA SOURCES"),i.map((function(e){return n.a.createElement(K,{key:e.id,label:e.label,checked:!!e.selected,disabled:!e.enabled||e.selected&&i.filter((function(e){return e.selected})).length<2,onChange:function(){return r(e.id)},radio:"claims"===e.type})})))}}]),t}(n.a.Component)),$=Object(m.b)((function(e){return{dataSources:Object(g.a)({},e.dataSources),organizations:Object.keys(e.organizations).map((function(t){return{value:t,label:e.organizations[t].name,selected:e.organizations[t].enabled,description:e.organizations[t].description}}))}}),(function(e){return{toggleDataSource:function(t){return e(function(e){return{type:v,payload:e}}(t))},toggleOrg:function(t){return e(function(e){return{type:"actions:organization:toggle",payload:e}}(t))}}}))(X),ee=(a(47),function(e){function t(){return Object(s.a)(this,t),Object(l.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return n.a.createElement("div",{className:"col-3 app-sidebar"},n.a.createElement($,null))}}]),t}(n.a.Component));a(48);window.require.config({paths:{vs:"/monaco-editor/min/vs"}});var te=function(e){function t(){return Object(s.a)(this,t),Object(l.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(c.a)(t,[{key:"shouldComponentUpdate",value:function(){return!1}},{key:"componentWillUnmount",value:function(){this.editor&&(this.editor.dispose(),this.editor=null)}},{key:"componentDidMount",value:function(){var e=this;window.require(["vs/editor/editor.main"],(function(t){if(e.editorNode){e.editor=t.editor.create(e.editorNode,Object(g.a)({},e.props.options,{value:e.props.query}));var a=window.jQuery,r=a(window),n=a(e.editorNode);a(e.divider).on("mousedown",(function(t){var a=t.clientY,o=n.css({overflow:"hidden"}).height();r.on("mouseup.resize",(function(){n.css({overflow:"visible"}),e.props.onHeightChange(n.outerHeight()),r.off(".resize")})),r.on("mousemove.resize",(function(e){n.height(o+e.clientY-a)}))}))}}))}},{key:"render",value:function(){var e=this;return n.a.createElement("div",null,n.a.createElement("div",{className:"sql-editor",ref:function(t){return e.editorNode=t},style:{height:this.props.height}}),n.a.createElement("div",{className:"sql-editor-resizer",ref:function(t){return e.divider=t}},"....."),n.a.createElement("button",{className:"btn btn-brand active",onClick:function(){return e.props.onQuery(e.editor.getValue())}},"RUN"))}}]),t}(n.a.Component);te.defaultProps={query:""};a(49);var ae=function(e){function t(){return Object(s.a)(this,t),Object(l.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(c.a)(t,[{key:"buildCsvUrl",value:function(){return"/sql/csv?q="+(e=this.props.query,function(e){for(;e.length%4;)e+="=";return e}(btoa(e)).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_"));var e}},{key:"render",value:function(){var e=this.props.data,t=void 0===e?{}:e;return n.a.createElement("div",{className:"table-wrap"},n.a.createElement("div",{className:"row"},n.a.createElement("div",{className:"col-6 align-middle"},n.a.createElement("h5",null,"Preview")),n.a.createElement("div",{className:"col-6 text-right"},n.a.createElement("a",{className:"btn btn-brand",href:this.buildCsvUrl(),download:"report.csv"},"DOWNLOAD CSV"))),n.a.createElement(re,{cols:t.header,rows:t.data}))}}]),t}(n.a.Component),re=function(e){function t(e){var a;return Object(s.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).wrapper=n.a.createRef(),a}return Object(d.a)(t,e),Object(c.a)(t,[{key:"componentDidUpdate",value:function(){this.syncHeader()}},{key:"componentDidMount",value:function(){this.syncHeader()}},{key:"syncHeader",value:function(){if(this.wrapper.current){var e=this.wrapper.current.querySelectorAll(".data-grid-header th");this.wrapper.current.querySelectorAll(".data-grid-body tr:first-child td").forEach((function(t,a){e[a].style.width=Math.floor(t.clientWidth+1)+"px"}))}}},{key:"render",value:function(){var e=this.props,t=e.rows,a=e.cols;if(!t.length)return n.a.createElement("p",{className:"text-center"},"No data");var r=n.a.createElement("thead",null,n.a.createElement("tr",null,a.map((function(e,t){return n.a.createElement("th",{key:"th-"+t,title:e},e)})))),o=t.map((function(e,t){return n.a.createElement("tr",{key:t,tabIndex:0},e.map((function(e,a){return n.a.createElement("td",{key:"cell-"+t+"-"+a},e)})))}));return n.a.createElement("div",{ref:this.wrapper,className:"data-grid-wrapper"},n.a.createElement("table",{className:"table table-sm table-hover data-grid"},r,n.a.createElement("tbody",null,o)))}}]),t}(n.a.Component);re.defaultProps={cols:[],rows:[]};var ne=a(13),oe=a.n(ne),ie=a(15);a(25);var se=function(e){function t(e){var a;return Object(s.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).state={numerator:0,denominator:1},a}return Object(d.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){var e=this;this.setState({animating:!0},(function(){window.jQuery({numerator:0,denominator:e.props.denominator}).animate({numerator:e.props.numerator,denominator:e.props.denominator},{duration:e.props.duration,easing:e.props.easing,step:function(t,a){return e.setState(Object(y.a)({},a.prop,t))},complete:function(){return e.setState({animating:!1})}})}))}},{key:"componentDidUpdate",value:function(){var e=this;this.state.animating||this.state.numerator===this.props.numerator||this.setState({animating:!0},(function(){window.jQuery({numerator:e.state.numerator,denominator:e.state.denominator}).animate({numerator:e.props.numerator,denominator:e.props.denominator},{duration:e.props.duration,easing:e.props.easing,step:function(t,a){return e.setState(Object(y.a)({},a.prop,t))},complete:function(){return e.setState({animating:!1})}})}))}},{key:"render",value:function(){var e=Math.max(Math.min(this.state.numerator/this.state.denominator*100,100),0),t=e>=50?1:0,a=function(e){return[100*Math.cos(2*Math.PI*e),100*Math.sin(2*Math.PI*e)]}(e/100),r=Object(ie.a)(a,2),o=r[0],i=r[1];return n.a.createElement("svg",{className:"chart",viewBox:"-110 -110 220 220"},n.a.createElement("defs",null,n.a.createElement("linearGradient",{id:"myGradient",gradientTransform:"rotate(90)"},n.a.createElement("stop",{offset:"5%","stop-color":"gold"}),n.a.createElement("stop",{offset:"95%","stop-color":"red"}))),n.a.createElement("text",{className:"chart-big-text",y:0},Math.round(e),"%"),n.a.createElement("text",{className:"chart-small-text",y:35},Math.round(this.state.numerator),"/",Math.round(this.state.denominator)),0===e?n.a.createElement("circle",{cx:0,cy:0,r:100,className:"chart-arc-bg"}):n.a.createElement("g",{style:{transform:"rotate(-0.25turn)"}},n.a.createElement("path",{fill:"url('#myGradient')",className:"chart-arc-main",d:"M 100 0 A 100 100 0 ".concat(t," 1 ").concat(o," ").concat(i)}),n.a.createElement("path",{className:"chart-arc-bg",d:"M ".concat(o," ").concat(i," A 100 100 0 ").concat(t?0:1," 1 100 0")})))}}]),t}(n.a.Component);function ce(e){return[100*Math.cos(2*Math.PI*e),100*Math.sin(2*Math.PI*e)]}se.defaultProps={duration:1200,easing:"easeInOutExpo"};var le=function(e){function t(e){var a;return Object(s.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).state={numerator:0,denominator:0},a}return Object(d.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){var e=this;this.setState({animating:!0},(function(){window.jQuery({numerator:10,denominator:0}).animate({numerator:e.props.numerator,denominator:e.props.denominator},{duration:e.props.duration,easing:e.props.easing,step:function(t,a){return e.setState(Object(y.a)({},a.prop,Math.round(t)))},complete:function(){return e.setState({animating:!1})}})}))}},{key:"componentDidUpdate",value:function(){var e=this;this.state.animating||this.state.numerator===this.props.numerator||this.setState({animating:!0},(function(){window.jQuery({numerator:e.state.numerator,denominator:e.state.denominator}).animate({numerator:e.props.numerator,denominator:e.props.denominator},{duration:200,easing:"linear",step:function(t,a){return e.setState(Object(y.a)({},a.prop,Math.round(t)))},complete:function(){return e.setState({animating:!1})}})}))}},{key:"render",value:function(){var e=this.state.numerator,t=[{min:10,max:30,className:"chart-arc-normal"},{min:30,max:70,className:"chart-arc-normal"},{min:70,max:85,className:"chart-arc-severe"},{min:85,max:90,className:"chart-arc-very-severe"}].map((function(e,t,a){var r=e.min/100,o=e.max/100;t>0&&(r+=.0025),t<a.length-1&&(o-=.0025);var i=ce(r),s=Object(ie.a)(i,2),c=s[0],l=s[1],u=ce(o),d=Object(ie.a)(u,2),m=d[0],p=d[1],h=o-r>.5?1:0;return n.a.createElement("path",{className:e.className,d:"M ".concat(c," ").concat(l," A 100 100 0 ").concat(h," 1 ").concat(m," ").concat(p)})}));return n.a.createElement("svg",{className:"chart",viewBox:"-110 -110 220 220"},n.a.createElement("text",{className:"chart-big-text",y:0},e),n.a.createElement("text",{className:"chart-smaller-text",y:25},"Average T-Score"),n.a.createElement("text",{className:"chart-smaller-text",y:45},"from ",this.state.denominator," patients"),n.a.createElement("text",{className:"chart-smaller-text",y:105,x:"-70"},"Normal"),n.a.createElement("text",{className:"chart-smaller-text",y:105,x:"70"},"Severe"),n.a.createElement("g",{style:{transform:"rotate(0.25turn)"}},t),n.a.createElement("path",{fill:"#000",d:"M 0 0 l -10 -10 20 0 z",style:{transform:"rotate(".concat(.1+Math.max((e-10)/100,0),"turn) translate(0, 87px)")}}))}}]),t}(n.a.Component);le.defaultProps={duration:1200,easing:"easeInOutExpo"};a(51);var ue=function(e){function t(){return Object(s.a)(this,t),Object(l.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this.props,t=e.date,a=e.clinic,r=e.measureName,o=e.numeratorValue,i=e.denominatorValue,s=e.measureDescription,c=e.numeratorDescription,l=e.denominatorDescription,u=e.measureId;return n.a.createElement("div",{className:"report-summary"},n.a.createElement("div",{className:"row"},n.a.createElement("div",{className:"col-8"},n.a.createElement("div",{className:"sub-title"},a,": ",oe()(t).format("MMMM YYYY")),n.a.createElement("div",{className:"title"},r)),n.a.createElement("div",{className:"col"},"pro"===u?n.a.createElement(le,{numerator:o,denominator:i}):n.a.createElement(se,{numerator:o,denominator:i}))),n.a.createElement("div",{className:"row"},n.a.createElement("div",{className:"col"},n.a.createElement("p",{className:"sub-title"},"POPULATION HEALTH IMPACT"),n.a.createElement("div",{dangerouslySetInnerHTML:{__html:s}}),n.a.createElement("br",null))),n.a.createElement("br",null),n.a.createElement("div",{className:"row"},n.a.createElement("div",{className:"col"},n.a.createElement("p",{className:"sub-title"},"NUMERATOR"),n.a.createElement("p",null,c)),n.a.createElement("div",{className:"col"},n.a.createElement("p",{className:"sub-title"},"DENOMINATOR"),n.a.createElement("p",null,l))))}}]),t}(n.a.Component);var de=function(e){function t(e){var a;return Object(s.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).state={loading:!0,error:null,data:null},a.timer=null,a}return Object(d.a)(t,e),Object(c.a)(t,[{key:"startClock",value:function(){var e=this,t=Date.now();!function a(){e.state.prestoLoading?e.setState({queryTime:Date.now()-t},(function(){e.timer=setTimeout(a,100)})):e.timer=null}()}},{key:"loadData",value:function(){var e=this,t=Object.keys(this.props.dataSources),a=new URLSearchParams(this.props.location.search);t.length&&(a.delete("ds"),t.forEach((function(t){e.props.dataSources[t].selected&&a.append("ds",t)}))),this.setState({loading:!0},(function(){w.request("api/measure/result/report?".concat(a)).then((function(t){e.setState({data:Object(g.a)({},t,{measureId:a.get("measure")}),loading:!1}),t.cohort_sql&&e.runQuery(t.cohort_sql)}),(function(t){return e.setState({error:t,loading:!1})}))}))}},{key:"runQuery",value:function(e){var t=this;this.setState({prestoLoading:!0,queryTime:0,query:e},(function(){t.startClock(),w.query(e).then((function(e){t.setState({prestoLoading:!1,prestoError:null,prestoData:e})}),(function(e){t.setState({prestoLoading:!1,prestoError:e,prestoData:null})}))}))}},{key:"componentDidMount",value:function(){this.loadData()}},{key:"componentDidUpdate",value:function(e){if(!this.state.loading){var t=e.dataSources||{};for(var a in t){if((this.props.dataSources||{})[a].selected!==t[a].selected)return this.loadData()}}}},{key:"renderEditor",value:function(){var e=this;if(!this.state.data||!this.state.data.cohort_sql)return null;var t=this.state,a=t.queryTime,r=t.prestoLoading,o=t.prestoData;return n.a.createElement(n.a.Fragment,null,n.a.createElement(te,Object.assign({query:this.state.data.cohort_sql},this.props.ui.sqlEditor,{onHeightChange:function(t){return e.props.dispatch({type:"actions:ui:sql-editor:setHeight",payload:t})},onQuery:function(t){return e.runQuery(t)}})),a?n.a.createElement("div",{className:"float-right",style:{marginTop:"-4em",fontSize:11,color:"#999",textAlign:"right"}},"Total time: ",function(e){var t=[],a=[{label:"week",n:6048e5},{label:"day",n:864e5},{label:"hour",n:36e5},{label:"minute",n:6e4},{label:"second",n:1e3},{label:"ms",n:1}];if(a.reduce((function(e,a){var r=Math.floor(e/a.n);return r?(t.push("".concat(r," ").concat(a.label).concat(r>1&&a.n>1?"s":"")),e-r*a.n):e}),e),t.length||t.push("0 ".concat(a.pop().label)),t.length>1){var r=t.pop();t[t.length-1]+=" and "+r}return t.join(", ")}(a),n.a.createElement("br",null),!r&&o?"Result rows: "+o.data.length:""):null)}},{key:"createSummaryRenderer",value:function(){return this.state.data?n.a.createElement(ue,{clinic:"All Clinics",date:this.state.data.measureDate,measureId:this.state.data.measureId,measureName:this.state.data.measureName,startValue:this.state.numeratorValue,numeratorValue:this.state.data.numeratorValue,denominatorValue:this.state.data.denominatorValue,measureDescription:this.state.data.measureDescription||"No description available for this measure",numeratorDescription:this.state.data.numeratorDescription||"No description available for the numerator of this measure",denominatorDescription:this.state.data.denominatorDescription||"No description available for the denominator of this measure"}):null}},{key:"render",value:function(){var e=this,t=this.state,a=t.error,r=t.prestoError,o=t.prestoData,i=t.prestoLoading,s=t.query;return a?(console.error(a),n.a.createElement("b",null,a.message)):n.a.createElement("div",null,n.a.createElement("div",{className:"row"},n.a.createElement(ee,null),n.a.createElement("div",{className:"col-9"},n.a.createElement("div",{className:"row"},n.a.createElement("div",{className:"col-6 align-middle"},n.a.createElement("h3",{style:{lineHeight:"43px",margin:0}},n.a.createElement(Q.a,{path:"/report",exact:!0,render:function(){return"Month Report"}}),n.a.createElement(Q.a,{path:"/report/editor",render:function(){return"Cohort Builder"}}))),n.a.createElement("div",{className:"col-6 text-right"},n.a.createElement("div",{className:"btn-group view-toggle",role:"group"},n.a.createElement(J.a,{className:"btn btn-brand",to:{pathname:"/report",search:this.props.location.search},exact:!0},"REPORT"),n.a.createElement(J.a,{className:"btn btn-brand",to:{pathname:"/report/editor",search:this.props.location.search},exact:!0},"BUILDER")))),n.a.createElement("br",null),n.a.createElement(Q.a,{path:"/report",exact:!0,render:function(){return e.createSummaryRenderer()}}),n.a.createElement(Q.a,{path:"/report/editor",exact:!0,render:function(){return e.renderEditor()}}),n.a.createElement("br",null),n.a.createElement("br",null),n.a.createElement("div",{style:{minHeight:474}},i?n.a.createElement("div",{className:"alert alert-info"},"Loading..."):r?n.a.createElement("div",{className:"alert alert-danger"},r.message):void 0===o?null:o&&o.data&&o.data.length?n.a.createElement(ae,{data:o,query:s}):n.a.createElement("div",{className:"alert alert-info"},"No data to display")),n.a.createElement("br",null),n.a.createElement("br",null))))}}]),t}(n.a.Component),me=Object(m.b)((function(e){return{ui:e.ui,dataSources:e.dataSources}}))(de),pe=a(16),he=a(1),fe=a.n(he),ye=a(23),ge=(a(52),function(e){function t(){return Object(s.a)(this,t),Object(l.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this,t=this.props.data,a=t.description,r=t.name,o=t.measures,i=[],s=oe()(q.startYear+1+"-01-01","YYYY-MM-DD");o.forEach((function(t){var a=[],o=0,c=function(r){var i=t.data[r],c=oe()(r),l=c.format("MMM YYYY"),u=void 0;"pro"===t.id?(l+=" - Average T-Score of ".concat(i.numerator," from ").concat(i.denominator," patients"),u=i.numerator):(l+=" - ".concat(i.numerator," of ").concat(i.denominator," patients"),u=Math.round(i.pct));var d=new URLSearchParams;if(d.set("date",c.format("YYYY-MM-DD")),d.set("measure",t.id),d.set("org",e.props.org.value),Object.keys(e.props.dataSources).forEach((function(t){e.props.dataSources[t].selected&&d.append("ds",t)})),c.isSame(s,"year"))a[o%12]=n.a.createElement("td",{key:r,title:l},n.a.createElement(ye.a,{to:"/report?".concat(d)},u));else{var m=oe()(c).add(1,"year").format("YYYY-MM");t.data[m]||(a[o%12]=n.a.createElement("td",{key:r,title:l},n.a.createElement(ye.a,{to:"/report?".concat(d),className:"text-muted"},u)))}o++};for(var l in t.data)c(l);a.length||a.push(n.a.createElement("td",{key:"empty-1"},"-"),n.a.createElement("td",{key:"empty-2"},"-"),n.a.createElement("td",{key:"empty-3"},"-"),n.a.createElement("td",{key:"empty-4"},"-"),n.a.createElement("td",{key:"empty-5"},"-"),n.a.createElement("td",{key:"empty-6"},"-"),n.a.createElement("td",{key:"empty-7"},"-"),n.a.createElement("td",{key:"empty-8"},"-"),n.a.createElement("td",{key:"empty-9"},"-"),n.a.createElement("td",{key:"empty-10"},"-"),n.a.createElement("td",{key:"empty-11"},"-"),n.a.createElement("td",{key:"empty-12"},"-")),i.push(n.a.createElement("tr",{key:r+"-"+t.name,className:e.props.selectedOrgId===e.props.orgId&&e.props.selectedMeasureId===t.id?"selected":"",onClick:function(a){"A"!==a.target.nodeName&&e.props.onRowClick(t)}},n.a.createElement("th",null,t.name," (","pro"===t.id?"T-Score":"%",")"),a))}));var c=n.a.createElement("thead",null,n.a.createElement("tr",null,n.a.createElement("th",null),["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"].map((function(e,t){return n.a.createElement("th",{key:"th-"+t},e)}))));return n.a.createElement("div",null,n.a.createElement("h4",null,a),n.a.createElement("div",{className:"table-responsive"},n.a.createElement("table",{className:"table table-sm table-hover timeline-grid"},c,n.a.createElement("tbody",null,i))))}}]),t}(n.a.Component));ge.defaultProps={data:{},startYear:q.startYear},ge.contextTypes={router:fe.a.object};var ve=Object(m.b)((function(e){return{dataSources:e.dataSources}}))(ge),be=(a(53),window.Highcharts),Ee=function(e){function t(){return Object(s.a)(this,t),Object(l.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){var e='-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol"';this.chart=window.Highcharts.chart("container",{chart:{type:"spline",plotBackgroundColor:"#F6F6F6",plotBorderColor:"#DDD",plotBorderWidth:1,zoomType:"x"},title:{align:"center",style:{fontFamily:e,fontSize:"calc(8px + 1vw)",fontWeight:500},useHTML:!0},subtitle:{align:"center",useHTML:!0,style:{fontFamily:e,fontSize:"1rem",fontWeight:300}},xAxis:[{lineWidth:0,crosshair:!0,type:"category",id:"year_axis",showEmpty:!1,categories:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],title:{text:null}},{lineWidth:0,id:"monthAxis",crosshair:!0,type:"datetime",minorTicks:!0,showEmpty:!1,zoomEnabled:!0,min:+oe()().utc().startOf("month"),max:+oe()().utc().endOf("month").startOf("day"),dateTimeLabelFormats:{day:"%e"},title:{text:null}}],yAxis:{id:"pct_axis",title:{text:"% Patients",style:{fontFamily:e,fontSize:"1rem",fontWeight:500}},lineColor:"#CCC",tickInterval:25,min:0,max:100,lineWidth:0},tooltip:{crossHairs:!0,shared:!0,useHTML:!0,headerFormat:'<b>{point.key}</b><hr style="margin: 2px 0"/><table>',pointFormat:'<tr><td style="color: {series.color}; text-align: right">{series.name}: </td><td style="text-align: right"><b>&nbsp;{point.y} %</b></td></tr>',footerFormat:"</table>",valueDecimals:2},plotOptions:{spline:{lineWidth:3,states:{hover:{lineWidth:4}},marker:{enabled:!1}}},series:[{name:"Current Year",id:"current_year",color:"#4a90e2",type:"areaspline",xAxis:"year_axis",shadow:!0,fillColor:{linearGradient:{x1:0,x2:0,y1:0,y2:1},stops:[[0,be.color("#4a90e2").setOpacity(.35).get()],[1,be.color("#4a90e2").setOpacity(0).get()]]},marker:{enabled:!1}},{name:"Previous Year",id:"previous_year",color:"#555",dashStyle:"ShortDot",xAxis:"year_axis",lineWidth:2}],navigation:{menuItemStyle:{fontSize:"10px"}},legend:{align:"left",verticalAlign:"top",layout:"horizontal",floating:!0,x:60,y:64}}),this.chart.update(this.props.chartOptions,!0,!0,!1)}},{key:"componentDidUpdate",value:function(){this.chart.drillUp(),this.chart.update(this.props.chartOptions,!0,!0)}},{key:"render",value:function(){return n.a.createElement("div",{id:"container"})}}]),t}(n.a.Component),Oe=function(e){function t(e){var a;return Object(s.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).state={chart:{},selection:{}},a.onRowClick=a.onRowClick.bind(Object(pe.a)(a)),a}return Object(d.a)(t,e),Object(c.a)(t,[{key:"loadDataIfNeeded",value:function(e){var t=this;if(this.props.loading)return!1;if(!this.props.organizations.length)return!1;if(!this.props.payers.length)return!1;if(!Object.keys(this.props.measures).length)return!1;if(!Object.keys(this.props.dataSources).length)return!1;if(!this.props.data)return this.props.dispatch(L());if(e){for(var a in e.dataSources){var r=e.dataSources[a];if(this.props.dataSources[a].selected!==r.selected)return this.props.dispatch(L())}var n=!0,o=!1,i=void 0;try{for(var s,c=function(){var e=s.value;if(t.props.payers.find((function(t){return t.value===e.value})).selected!==e.selected)return{v:t.props.dispatch(L())}},l=e.payers[Symbol.iterator]();!(n=(s=l.next()).done);n=!0){var u=c();if("object"===typeof u)return u.v}}catch(v){o=!0,i=v}finally{try{n||null==l.return||l.return()}finally{if(o)throw i}}var d=!0,m=!1,p=void 0;try{for(var h,f=function(){var e=h.value;if(t.props.organizations.find((function(t){return t.value===e.value})).selected!==e.selected)return{v:t.props.dispatch(L())}},y=e.organizations[Symbol.iterator]();!(d=(h=y.next()).done);d=!0){var g=f();if("object"===typeof g)return g.v}}catch(v){m=!0,p=v}finally{try{d||null==y.return||y.return()}finally{if(m)throw p}}}}},{key:"componentDidUpdate",value:function(e){this.loadDataIfNeeded(e)}},{key:"componentDidMount",value:function(){this.loadDataIfNeeded()}},{key:"getSelection",value:function(){var e=this.state.selection,t=e.orgId,a=e.measureId;t||(t=Object.keys(this.props.data.organizations).shift());var r,n=this.props.data.organizations[t];return n||(t=Object.keys(this.props.data.organizations).shift(),n=this.props.data.organizations[t]),r=a?n.measures.find((function(e){return e.id===a})):n.measures[0],{orgId:t,org:n,measure:r}}},{key:"getChartOptions",value:function(e,t){var a={title:{text:t.name},subtitle:{text:e.description},series:[{data:[],id:"current_year",name:q.startYear+1,xAxis:"year_axis"},{data:[],id:"previous_year",name:q.startYear,xAxis:"year_axis"}],yAxis:{title:{text:"% Patients"}}};return"pro"===t.id?(Object.keys(t.data).forEach((function(e){var r=e.split("-"),n=Object(ie.a)(r,2),o=n[0],i=n[1],s=t.data[e],c={x:parseInt(i,10)-1,y:s.numerator,name:oe()(e).format("MMMM"),xAxis:0};o===String(q.startYear+1)?a.series[0].data.push(c):o===String(q.startYear)&&a.series[1].data.push(c)})),a.tooltip={headerFormat:'<b>{point.key} - Average T-Score</b><hr style="margin: 2px 0"/><table>',pointFormat:'<tr><td style="color: {series.color}; text-align: right">{series.name}: </td><td style="text-align: right"><b>&nbsp;{point.y}</b></td></tr>',valueDecimals:0},a.yAxis.title.text="Avg. T-Score"):Object.keys(t.data).forEach((function(e){var r=e.split("-"),n=Object(ie.a)(r,2),o=n[0],i=n[1],s=t.data[e],c={x:parseInt(i,10)-1,y:s.pct,name:oe()(e).format("MMMM"),xAxis:0};o===String(q.startYear+1)?a.series[0].data.push(c):o===String(q.startYear)&&a.series[1].data.push(c)})),a}},{key:"onRowClick",value:function(e,t){this.setState({selection:{orgId:e,measureId:t.id}})}},{key:"renderStage",value:function(){var e=this,t=this.props,a=t.error,r=t.loading,o=t.data;if(r)return n.a.createElement("p",{style:{textAlign:"center"}},"Loading...");if(a)return n.a.createElement("pre",null,a.stack);if(!o)return n.a.createElement("p",{style:{textAlign:"center"}},"No data to display");var i=this.getSelection(),s=i.orgId,c=i.org,l=i.measure,u=[],d=function(t){var a=e.props.organizations.find((function(e){return e.value===t})),r=o.organizations[t];if(!a.selected)return"continue";u.push(n.a.createElement(ve,{key:"timeline-"+t,data:r,org:a,orgId:t,onRowClick:function(a){return e.onRowClick(t,a)},selectedOrgId:s,selectedMeasureId:l.id}))};for(var m in o.organizations)d(m);return n.a.createElement(n.a.Fragment,null,n.a.createElement(Ee,{key:"line-chart",chartOptions:this.getChartOptions(c,l)}),u)}},{key:"render",value:function(){return n.a.createElement("div",{className:"row"},n.a.createElement(ee,null),n.a.createElement("div",{className:"col-9"},this.renderStage()))}}]),t}(n.a.Component),je=Object(m.b)((function(e){return{organizations:Object.keys(e.organizations).map((function(t){return{value:t,label:e.organizations[t].name,selected:e.organizations[t].enabled,description:e.organizations[t].description}})),payers:Object.keys(e.payers).map((function(t){return{value:t,label:e.payers[t].label,selected:e.payers[t].selected}})),measures:e.measures,dataSources:e.dataSources,data:e.measureResults.data,loading:e.measureResults.loading,error:e.measureResults.error}}))(Oe),Ne=a(30),ke=a.n(Ne),xe=function(e){function t(e){var a;return Object(s.a)(this,t),(a=Object(l.a)(this,Object(u.a)(t).call(this,e))).state={email:"user@aco.org",password:"password"},a.onSubmit=a.onSubmit.bind(Object(pe.a)(a)),a.onChange=a.onChange.bind(Object(pe.a)(a)),a}return Object(d.a)(t,e),Object(c.a)(t,[{key:"onSubmit",value:function(e){e.preventDefault(),this.props.login(this.state.email,this.state.password)}},{key:"onChange",value:function(e){this.setState(Object(y.a)({},e.target.name,e.target.value))}},{key:"render",value:function(){var e=(this.props.location.state||{from:{pathname:"/measures"}}).from;return e&&e.pathname&&"/"!==e.pathname||(e={pathname:"/measures"}),this.props.currentUser?n.a.createElement(B.a,{to:e,push:!0}):n.a.createElement("div",{className:"row"},n.a.createElement("form",{className:"mx-auto col-xs-12 col-sm-8 col-md-6 col-lg-4",onSubmit:this.onSubmit},this.props.error&&n.a.createElement("div",{className:"alert alert-danger",role:"alert"},String(this.props.error)),n.a.createElement("div",{className:"form-group"},n.a.createElement("label",{htmlFor:"email1"},"Email address"),n.a.createElement("input",{type:"email",className:"form-control",id:"email1",placeholder:"Enter email",name:"email",value:this.state.email,onChange:this.onChange,disabled:this.props.loading}),n.a.createElement("small",{className:"form-text text-muted"},'Enter "user@aco.org" or "user@payer.org"')),n.a.createElement("div",{className:"form-group"},n.a.createElement("label",{htmlFor:"password1"},"Password"),n.a.createElement("input",{type:"password",className:"form-control",id:"password1",placeholder:"Password",name:"password",value:this.state.password,onChange:this.onChange,disabled:this.props.loading}),n.a.createElement("small",{className:"form-text text-muted"},'The default password is "password"')),n.a.createElement("br",null),n.a.createElement("button",{disabled:this.props.loading,type:"submit",className:"btn btn-block btn-brand active"},this.props.loading&&n.a.createElement("i",{className:"fas fa-spinner fa-spin"})," Login"),n.a.createElement("br",null),n.a.createElement("br",null),n.a.createElement("p",{className:"text-center"},n.a.createElement("img",{src:ke.a,alt:"BCH Logo",width:"150"}))))}}]),t}(n.a.Component),Se=Object(m.b)((function(e){return e.auth}),(function(e){return{login:function(t,a){return e(function(e,t){return function(a){return a(A(!0)),w.login(e,t).then((function(e){sessionStorage.currentUser=JSON.stringify(e),a(z({currentUser:e,error:null,loading:!1}))})).catch((function(e){console.error(e),a(z({error:e,loading:!1}))}))}}(t,a))}}}))(xe),we=(a(54),function(e){function t(){return Object(s.a)(this,t),Object(l.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this.props,t=e.user,a=e.component,r=Object(W.a)(e,["user","component"]);return n.a.createElement(Q.a,Object.assign({},r,{render:function(e){return t?n.a.createElement(a,e):n.a.createElement(B.a,{to:{pathname:"/login",state:{from:e.location}}})}}))}}]),t}(n.a.Component));function Me(e){var t=Object(m.b)((function(t){return Object(g.a)({},e,{user:t.auth.currentUser})}))(we);return n.a.createElement(t,e)}var De=function(e){function t(){return Object(s.a)(this,t),Object(l.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return n.a.createElement(p.a,null,n.a.createElement("div",{className:"App"},n.a.createElement(Z,{user:this.props.user,loading:this.props.loading,dispatch:this.props.dispatch}),n.a.createElement("div",{className:"container",style:{marginTop:30}},n.a.createElement(Me,{path:"/",component:me,exact:!0}),n.a.createElement(Me,{path:"/report",component:me}),n.a.createElement(Me,{path:"/measures",component:je}),n.a.createElement(Q.a,{path:"/login",component:Se}))))}}]),t}(n.a.Component),Ce=Object(m.b)((function(e){return{user:e.auth.currentUser,loading:e.auth.loading}}))(De),Ae=function(e){function t(){return Object(s.a)(this,t),Object(l.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return n.a.createElement(p.a,null,n.a.createElement(m.a,{store:_},n.a.createElement(Ce,null)))}}]),t}(n.a.Component);i.a.render(n.a.createElement(Ae,null),document.getElementById("root"))}},[[33,1,2]]]);
//# sourceMappingURL=main.1e6c52c9.chunk.js.map